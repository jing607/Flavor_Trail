<nav class="navbar navbar-expand-lg top-auto py-lg-0 position-fixed w-100 py-0" id="navbar">
    <div class="container">
        <!-- Logo -->
        <h1 class="fs-0">
            <a class="navbar-brand d-flex py-lg-0 d-lg-block d-none" href="index.html">
                <img src="/assets/images/Logo-navbar.svg" alt="logo">
            </a>
        </h1>

        <!-- Toggler for mobile -->
        <button class="navbar-toggler navbar-toggler-custom p-10 rounded-start-3" type="button" data-bs-toggle="offcanvas" href="#offcanvasNav" role="button" aria-controls="offcanvasNav" id="navbarToggler">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" id="burgerIcon" class="burger-icon">
                <path d="M4 12H20M4 6H20M4 18H20" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" id="closeIcon" class="d-none">
                <path d="M18 6L6 18M6 6L18 18" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>     
        </button>

        <!-- Desktop menu -->
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav py-lg-7 mb-2 mb-lg-0 gap-lg-7">
                <li class="nav-item">
                    <a class="nav-link py-lg-3 px-lg-5" href="allPost.html">所有貼文</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link py-lg-3 px-lg-5" href="#">關於我們</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link p-lg-2 search-icon" href="#" type="button">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M21 21L16.7 16.7M19 11C19 15.4183 15.4183 19 11 19C6.58172 19 3 15.4183 3 11C3 6.58172 6.58172 3 11 3C15.4183 3 19 6.58172 19 11Z" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </a>
                </li>
                <li class="nav-item border border-black" id="desktop-auth-button">
                    <a href="login.html" class="nav-link nav-item-btn py-lg-3 px-lg-5">登入/註冊</a>
                </li>
            </ul>
        </div>
        
        <!-- Mobile menu (Offcanvas) -->
        <div class="offcanvas offcanvas-start w-100 border-0 d-lg-none" tabindex="-1" id="offcanvasNav" aria-labelledby="offcanvasNavLabel">
            <div class="offcanvas-header d-flex justify-content-between mb-12">
                <h1 class="offcanvas-title" id="offcanvasNavLabel">
                    <a href="index.html">
                        <img src="/assets/images/Logo-navbar.svg" alt="logo">
                    </a>
                </h1>
                <ul class="nav-item border border-black" id="mobile-auth-button">
                    <a href="login.html" class="nav-link nav-item-btn py-3 px-5 fw-bold">登入/註冊</a>
                </ul>
            </div>
            <ul class="offcanvas-body navbar-nav vh-100 pt-0">
                <li class="nav-item mb-10">
                    <ul class="search-form d-flex gap-2 flex-wrap">
                        <li class="input-group rounded-3 bg-white">
                            <input class="form-control search-input py-2 px-5 bg-white" type="text" name="search" placeholder="附近美味">
                            <a href="#" class="input-group-text border-0 bg-transparent py-2 ps-0 pe-5">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M21 21L16.7 16.7M19 11C19 15.4183 15.4183 19 11 19C6.58172 19 3 15.4183 3 11C3 6.58172 6.58172 3 11 3C15.4183 3 19 6.58172 19 11Z" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </a>
                        </li>
                        <li class="dropdown position-relative">
                            <button class="dropdown-btn d-flex align-items-center justify-content-between py-2 ps-5 pe-2 rounded-3 bg-white border-0" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                地理位置
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="ms-5 dropdown-arrow">
                                    <path d="M6 9L12 15L18 9" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>                            
                            </button>
                            <ul class="dropdown-menu custom-dropdown-menu position-absolute w-100">
                                <li><a class="dropdown-item" href="#">臺北市</a></li>
                                <li><a class="dropdown-item" href="#">新北市</a></li>
                                <li><a class="dropdown-item" href="#">桃園市</a></li>
                                <li><a class="dropdown-item" href="#">臺中市</a></li>
                                <li><a class="dropdown-item" href="#">臺南市</a></li>
                                <li><a class="dropdown-item" href="#">高雄市</a></li>
                            </ul>
                        </li>
                        <li class="dropdown">
                            <button class="dropdown-btn d-flex align-items-center justify-content-between py-2 ps-5 pe-2 rounded-3 bg-white border-0" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                美食類型
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="ms-5 dropdown-arrow">
                                    <path d="M6 9L12 15L18 9" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>                            
                            </button>
                            <ul class="dropdown-menu custom-dropdown-menu position-absolute w-100">
                                <li><a class="dropdown-item" href="#">主食</a></li>
                                <li><a class="dropdown-item" href="#">甜點</a></li>
                                <li><a class="dropdown-item" href="#">飲料</a></li>
                                <li><a class="dropdown-item" href="#">水果</a></li>
                                <li><a class="dropdown-item" href="#">零食</a></li>
                                <li><a class="dropdown-item" href="#">熟食</a></li>
                                <li><a class="dropdown-item" href="#">未烹飪食材</a></li>
                            </ul>
                        </li>
                    </ul>
                </li>
                <li class="nav-item mb-10">
                    <h2 class="fs-1 fw-bolder">
                        <a class="nav-link p-0" href="#" data-bs-toggle="modal" data-bs-target="#shareFoodModal">分享美味</a>
                    </h2>
                </li>
                <li class="nav-item mb-10">
                    <h2 class="fs-1 fw-bolder">
                        <a class="nav-link p-0" href="allPost.html">所有貼文</a>
                    </h2>
                </li>
                <li class="nav-item">
                    <h2 class="fs-1 fw-bolder">
                        <a class="nav-link p-0" href="#">關於我們</a>
                    </h2>
                </li>
            </ul>
        </div>
    </div>
</nav>

<!-- Search bar for desktop -->
<div class="search d-none">
    <div class="search-bar container d-flex">
        <a class="navbar-brand d-flex align-items-center me-4" href="index.html">
            <img src="/assets/images/Logo-navbar.svg" alt="logo">
        </a>
        <ul class="search-form d-flex py-7 gap-2 ms-auto me-2 flex-grow-1 justify-content-end">
            <li class="input-group mb-5 mb-lg-0 rounded-3 bg-white">
                <input class="form-control search-input py-2 px-5 bg-white" type="text" name="search" placeholder="附近美味">
                <a href="#" class="input-group-text border-0 bg-transparent py-2 ps-0 pe-5">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M21 21L16.7 16.7M19 11C19 15.4183 15.4183 19 11 19C6.58172 19 3 15.4183 3 11C3 6.58172 6.58172 3 11 3C15.4183 3 19 6.58172 19 11Z" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </a>
            </li>
            <li class="dropdown">
                <button class="nav-link dropdown-btn d-flex align-items-center justify-content-between py-2 ps-5 pe-2 gap-5 rounded-3 bg-white" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                    地理位置
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="dropdown-arrow">
                        <path d="M6 9L12 15L18 9" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>                            
                </button>
                <ul class="dropdown-menu custom-dropdown-menu">
                    <li><a class="dropdown-item" href="#">臺北市</a></li>
                    <li><a class="dropdown-item" href="#">新北市</a></li>
                    <li><a class="dropdown-item" href="#">桃園市</a></li>
                    <li><a class="dropdown-item" href="#">臺中市</a></li>
                    <li><a class="dropdown-item" href="#">臺南市</a></li>
                    <li><a class="dropdown-item" href="#">高雄市</a></li>
                </ul>
            </li>
            <li class="dropdown">
                <button class="nav-link dropdown-btn d-flex align-items-center justify-content-between py-2 ps-5 pe-2 gap-5 rounded-3 bg-white" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                    美食類型
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="dropdown-arrow">
                        <path d="M6 9L12 15L18 9" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>                            
                </button>
                <ul class="dropdown-menu custom-dropdown-menu">
                    <li><a class="dropdown-item" href="#">主食</a></li>
                    <li><a class="dropdown-item" href="#">甜點</a></li>
                    <li><a class="dropdown-item" href="#">飲料</a></li>
                    <li><a class="dropdown-item" href="#">水果</a></li>
                    <li><a class="dropdown-item" href="#">零食</a></li>
                    <li><a class="dropdown-item" href="#">熟食</a></li>
                    <li><a class="dropdown-item" href="#">未烹飪食材</a></li>
                </ul>
            </li>
        </ul>
        <a class="close-btn d-flex flex-column align-items-center justify-content-center ms-2 bg-black rounded-bottom-3 text-white fw-bold">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="mb-2">
                <path d="M18 6L6 18M6 6L18 18" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            關閉
        </a>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        /* 向下滾動 - 隱藏 navbar & 向上滾動 - 顯示 navbar */
        let lastScrollTop = 0;
        const navbar = document.getElementById('navbar');
        navbar.style.top = "0";
        function handleNavbarScroll() {
            let scrollTop = window.pageYOffset || document.documentElement.scrollTop;

            navbar.style.top = (scrollTop > lastScrollTop) ? "-88px" : "0";
            lastScrollTop = scrollTop;
            
            if (scrollTop > 40) {
                navbarToggler.classList.add('scrolled-navbar-toggler');
            } else {
                navbarToggler.classList.remove('scrolled-navbar-toggler');
            }
        }
        window.addEventListener('scroll', handleNavbarScroll);

        /* 模擬登入後「登入/註冊」按鈕變成「我的帳號」下拉選單 */
        const desktopAuthButton = document.getElementById('desktop-auth-button');
        const mobileAuthButton = document.getElementById('mobile-auth-button');

        function setLoggedInState() {
            const accountMenuHTML = `
                <li class="nav-item dropdown nav-account-menu">
                    <a class="nav-link dropdown-toggle nav-dropdown-btn py-3 px-5 position-relative d-flex align-items-center" href="#" id="accountDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        我的帳號
                        <span class="position-absolute top-0 start-100 translate-middle badge rounded-circle bg-primary p-1">
                            <span class="visually-hidden">unread messages</span>
                        </span>
                    </a>
                    <ul class="dropdown-menu nav-dropdown-menu mt-1 border-0" aria-labelledby="accountDropdown">
                        <li><a class="dropdown-item" href="#">我的主頁</a></li>
                        <li><a class="dropdown-item" href="account-posts.html">我的發文</a></li>
                        <li><a class="dropdown-item" href="account-notifications.html">全部通知</a></li>
                        <li><a class="dropdown-item logout" href="login.html" id="logout">登出</a></li>
                    </ul>
                </li>
            `;
            
            desktopAuthButton.innerHTML = accountMenuHTML;
            mobileAuthButton.innerHTML = accountMenuHTML;

            document.getElementById('logout').addEventListener('click', function () {
                localStorage.removeItem('loggedIn');
                window.location.reload(); 
            });
        } 
        
        function setLoggedOutState() {
            const loginButtonHTML = `
                <a href="login.html" class="nav-link nav-item-btn py-3 px-5 fw-bold">登入/註冊</a>
            `;
            desktopAuthButton.innerHTML = loginButtonHTML;
            mobileAuthButton.innerHTML = loginButtonHTML;

            desktopAuthButton.addEventListener('click', function () {
                localStorage.setItem('loggedIn', true);
            });
            mobileAuthButton.addEventListener('click', function() {
                localStorage.setItem('loggedIn', true);
            })
        }

        let isLoggedIn = localStorage.getItem('loggedIn');
        if (isLoggedIn) {
            setLoggedInState();
        } else {
            setLoggedOutState();
        }

        /* 下拉選單上下箭頭切換 */
        document.addEventListener('click', function (event) {
            const isDropdownButton = event.target.closest('.dropdown-btn');
            const dropdownArrows = document.querySelectorAll('.dropdown-arrow');

            if (!isDropdownButton) {
                dropdownArrows.forEach(arrow => {
                    arrow.classList.remove('flip-arrow');
                });
            }
        });

        const dropdownButtons = document.querySelectorAll('.dropdown-btn');
        
        dropdownButtons.forEach(button => {
            button.addEventListener('click', function () {
                const dropdownArrow = event.currentTarget.querySelector('.dropdown-arrow');
                dropdownArrow.classList.toggle('flip-arrow');
            });
        })

        /* 切換 navbar 和 搜尋欄 */
        const searchIcon = document.querySelector('.search-icon');
        const searchBar = document.querySelector('.search');
        const closeBtn = document.querySelector('.close-btn');

        searchIcon.addEventListener('click', function () {
            searchBar.classList.remove('d-none');  // 顯示搜尋欄
            navbar.classList.add('d-none');  // 隱藏導航欄
        });

        closeBtn.addEventListener('click', function () {
            searchBar.classList.add('d-none');  // 隱藏搜尋欄
            navbar.classList.remove('d-none');  // 顯示導航欄
        });

        /* 切換漢堡圖標和關閉圖標 */
        const navbarToggler = document.getElementById('navbarToggler');
        const burgerIcon = document.getElementById('burgerIcon');
        const closeIcon = document.getElementById('closeIcon');

        function toggleIcons() {
            burgerIcon.classList.toggle('d-none');
            closeIcon.classList.toggle('d-none');
            navbarToggler.classList.toggle('toggled');
        };

        navbarToggler.addEventListener('click', toggleIcons);
    });

    
</script>